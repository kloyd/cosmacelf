                        	CPU 1802
                        
                        ;
                        ; Register Definitions:
                        ;
   0000                 R0	EQU	0
   0001                 R1	EQU	1
   0002                 R2	EQU	2
   0003                 R3	EQU	3
   0004                 R4	EQU	4
   0005                 R5	EQU	5
   0006                 R6	EQU	6
   0007                 R7	EQU	7
   0008                 R8	EQU	8
   0009                 R9	EQU	9
   000a                 R10	EQU	10
   000b                 R11	EQU	11
   000c                 R12	EQU	12
   000d                 R13	EQU	13
   000e                 R14	EQU	14
   000f                 R15	EQU	15
                        
                        ;; Stack
   ffbf                 UserStack EQU 0FFBFH
                        ;; SCRT routine locations
   0adb                 CALL	EQU 0ADBH
   0aed                 RETURN	EQU 0AEDH
                        
   8000                 	ORG 8000H
                        	; Setup for SCRT routines.
                        	; Set R3 as program counter
   8000   f8 80         	LDI HIGH main
   8002   b3            	PHI R3
   8003   f8 07         	LDI LOW main
   8005   a3            	PLO R3
   8006   d3            	SEP R3
                        	; Main program entry.	
                        	; Setup stack pointer R2 @7FBFh
   8007   f8 ff         main	LDI HIGH UserStack
   8009   b2            	PHI R2
   800a   f8 bf         	LDI LOW UserStack
   800c   a2            	PLO R2
   800d   e2            	SEX R2
                        	; Setup 4 to CALL routine 8ADB
   800e   f8 0a         	LDI	HIGH CALL
   8010   b4            	PHI	R4
   8011   f8 db         	LDI	LOW CALL
   8013   a4            	PLO	R4
                        	; Setup R5 to RETURN (8AED)
   8014   f8 0a         	LDI	HIGH RETURN
   8016   b5            	PHI	R5
   8017   f8 ed         	LDI	LOW RETURN
   8019   a5            	PLO	R5
                        	
                        	; R7 points to string.
   801a   f8 80         	LDI HIGH greeting
   801c   b7            	PHI R7
   801d   f8 24         	LDI LOW greeting
   801f   a7            	PLO R7
                        	; Call SCRT dispatcher (R3 points to 8526H)
                        	; How to understand this weirdness.
                        	; R4 points to a Dispatch routine.
                        	; R3 is the program counter. R3 will be incremented to the address
                        	; of the data after the SEP R4 instruction and contains the address
                        	; of the actual routine.
                        	; ergo it will indirectly jump to 8526H
   8020   d4            	SEP R4
   8021   05 26         	WORD 0526H
                        	; Exit to Membership Card monitor.
   8023   d1            	SEP 1
                        	
   8024   48 65 6c 6c   greeting	TEXT "Hello, I'm a TIL."
   8028   6f 2c 20 49   
   802c   27 6d 20 61   
   8030   20 54 49 4c   
   8034   2e            
   8035   0d            	BYTE 0dh
   8036   0a            	BYTE 0Ah
   8037   20 24         	TEXT " $"
                        	
   8039   00            	BYTE 0
                        
                        
   803a                 	END
0adb  CALL          0000  R0            0001  R1            000a  R10       
000b  R11           000c  R12           000d  R13           000e  R14       
000f  R15           0002  R2            0003  R3            0004  R4        
0005  R5            0006  R6            0007  R7            0008  R8        
0009  R9            0aed  RETURN        ffbf  UserStack     8024  greeting  
8007  main          
